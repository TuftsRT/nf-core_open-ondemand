---
cluster: "pax"

attributes:
<%= File.read("/etc/ood/config/apps/dashboard/batch_connect/partials/cpu_partition.yml").indent(2) %>
<%= File.read("/etc/ood/config/apps/dashboard/batch_connect/partials/num_cores_generic.yml").indent(2) %>
<%= File.read("/etc/ood/config/apps/dashboard/batch_connect/partials/num_memory_generic.yml").indent(2) %>

  executor:
    label: Which nextflow executor to use?
    widget: select
    options:
    - [
        "slurm", "slurm",
        data-hide-partition: true,
        data-hide-num-cores: true,
        data-hide-num-memory: true
      ]
    - ["local", "local"]
    help: |
      With slurm, tasks will be distributed to different nodes, local means all tasks will run on a single node.

  workdir:
    label: "Working Directory"
    widget: "path_selector"
    directory: "/cluster/tufts"
    required: false
    label: Working directory
    favorites:
        - /cluster/tufts
        - /cluster/home
    
  resume:
    label: Resume
    widget: check_box
    checked_value: 1
    unchecked_value: 0
    help: |
           Resume previous run if found

  tower_access_token:
    widget: "text_field"
    required: false
    label: "TOWER_ACCESS_TOKEN (Optional)"
    help: "Your TOWER_ACCESS_TOKEN used to monitor runs on [Nextflow Tower](https://seqera.io)."



  input_output_options:
    label: "Input/output options"
    widget: 'check_box'
    html_options:
      data:
        hide-input-when-un-checked: true
        hide-outdir-when-un-checked: true
        hide-multiqc_title-when-un-checked: true
    help: "Define where the pipeline should find input data and save output data."

  input:
    label: "input"
    widget: path_selector
    directory: /cluster/tufts
    favorites:
      - /cluster/tufts
      - /cluster/home 
    help: "Path to comma-separated file `.csv` containing information about the samples in the experiment."

  outdir:
    label: "outdir"
    widget: path_selector
    directory: /cluster/tufts
    favorites:
      - /cluster/tufts
      - /cluster/home 
    help: "The output directory where the results will be saved. You have to use absolute paths to storage on Cloud infrastructure."

  multiqc_title:
    label: "multiqc_title"
    widget: text_field
    help: "MultiQC report title. Printed as page header, used for filename if not otherwise specified."

  clustering_params:
    label: "Clustering parameters"
    widget: 'check_box'
    html_options:
      data:
        hide-save_mmseqs_db-when-un-checked: true
        hide-clustering_tool-when-un-checked: true
        hide-cluster_seq_identity-when-un-checked: true
        hide-cluster_coverage-when-un-checked: true
        hide-cluster_cov_mode-when-un-checked: true
        hide-save_mmseqs_clustering-when-un-checked: true
        hide-cluster_size_threshold-when-un-checked: true
        hide-save_mmseqs_chunked_fasta-when-un-checked: true
    help: "Use these parameters to control the flow of the clustering subworkflow execution."

  save_mmseqs_db:
    label: "save_mmseqs_db"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save the db output folder of mmseqs createdb"

  clustering_tool:
    label: "clustering_tool"
    widget: select
    options:
      - ['linclust', 'linclust']
      - ['cluster', 'cluster']
    help: "Choose clustering algorithm. Either simple `cluster` for medium size inputs, or `linclust` for less sensitive clustering of larger datasets."

  cluster_seq_identity:
    label: "cluster_seq_identity"
    widget: number_field
    value: 0.5
    step: 1
    help: "mmseqs parameter for minimum sequence identity"

  cluster_coverage:
    label: "cluster_coverage"
    widget: number_field
    value: 0.9
    step: 1
    help: "mmseqs parameter for minimum sequence coverage ratio"

  cluster_cov_mode:
    label: "cluster_cov_mode"
    widget: number_field
    value: 0
    step: 1
    help: "mmseqs parameter for coverage mode: 0 for both, 1 for target and 2 for query sequence"

  save_mmseqs_clustering:
    label: "save_mmseqs_clustering"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save the clustering output folder of mmseqs cluster or linclust"

  cluster_size_threshold:
    label: "cluster_size_threshold"
    widget: number_field
    value: 25
    step: 1
    help: "Minimum clustering chunk size threshold to create seed Multiple Sequence Alignments upon."

  save_mmseqs_chunked_fasta:
    label: "save_mmseqs_chunked_fasta"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save membership-filtered initial mmseqs clusters in fasta format"

  alignment_params:
    label: "Alignment parameters"
    widget: 'check_box'
    html_options:
      data:
        hide-alignment_tool-when-un-checked: true
        hide-trim_msa-when-un-checked: true
        hide-clipkit_out_format-when-un-checked: true
        hide-trim_ends_only-when-un-checked: true
        hide-gap_threshold-when-un-checked: true
        hide-recruit_sequences_with_models-when-un-checked: true
        hide-hmmsearch_write_target-when-un-checked: true
        hide-hmmsearch_write_domain-when-un-checked: true
        hide-hmmsearch_evalue_cutoff-when-un-checked: true
        hide-save_hmmsearch_results-when-un-checked: true
        hide-hmmsearch_query_length_threshold-when-un-checked: true
        hide-save_hmmsearch_filtered_fasta-when-un-checked: true
    help: "Use these parameters to control the Multiple Sequence Alignment subworkflow execution."

  alignment_tool:
    label: "alignment_tool"
    widget: select
    options:
      - ['famsa', 'famsa']
      - ['mafft', 'mafft']
    help: "Choose alignment tool. FAMSA is recommended as best time-memory-accuracy combination option."

  clipkit_out_format:
    label: "clipkit_out_format"
    widget: text_field
    value: "clipkit"
    help: "Choose the output format of the clipped alignment."

  trim_ends_only:
    label: "trim_ends_only"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Choose if ClipKIT should only clip gaps at the ends of the MSAs."

  gap_threshold:
    label: "gap_threshold"
    widget: number_field
    value: 0.5
    step: 1
    help: "Multiple Sequence Alignment (MSA) positions with gappiness greater than this threshold will be trimmed"

  hmmsearch_evalue_cutoff:
    label: "hmmsearch_evalue_cutoff"
    widget: number_field
    value: 0.001
    step: 1
    help: "hmmsearch e-value cutoff threshold for reported results"

  save_hmmsearch_results:
    label: "save_hmmsearch_results"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save the output of hmmsearch (.domtbl.gz and .tbl.gz)"

  hmmsearch_query_length_threshold:
    label: "hmmsearch_query_length_threshold"
    widget: number_field
    value: 0.9
    step: 1
    help: "hmmsearch minimum length percentage filter of hit env vs query length"

  save_hmmsearch_filtered_fasta:
    label: "save_hmmsearch_filtered_fasta"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save family fasta files after recruiting sequences with hmmsearch"

  redundancy_params:
    label: "Redundancy removal parameters"
    widget: 'check_box'
    html_options:
      data:
        hide-remove_family_redundancy-when-un-checked: true
        hide-hmmsearch_family_length_threshold-when-un-checked: true
        hide-save_non_redundant_fams_fasta-when-un-checked: true
        hide-remove_sequence_redundancy-when-un-checked: true
        hide-cluster_seq_identity_for_redundancy-when-un-checked: true
        hide-cluster_coverage_for_redundancy-when-un-checked: true
        hide-cluster_cov_mode_for_redundancy-when-un-checked: true
        hide-save_non_redundant_seqs_fasta-when-un-checked: true
    help: "Use these parameters to control the redundancy removal subworkflow execution."

  hmmsearch_family_length_threshold:
    label: "hmmsearch_family_length_threshold"
    widget: number_field
    value: 0.9
    step: 1
    help: "hmmsearch minimum length percentage filter of hit env vs query length, for redundant family removal"

  save_non_redundant_fams_fasta:
    label: "save_non_redundant_fams_fasta"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save only the fasta files of non-redundant families (might still contain redundant sequences)"

  cluster_seq_identity_for_redundancy:
    label: "cluster_seq_identity_for_redundancy"
    widget: number_field
    value: 0.9
    step: 1
    help: "mmseqs parameter for minimum sequence identity"

  cluster_coverage_for_redundancy:
    label: "cluster_coverage_for_redundancy"
    widget: number_field
    value: 0.9
    step: 1
    help: "mmseqs parameter for minimum sequence coverage ratio"

  cluster_cov_mode_for_redundancy:
    label: "cluster_cov_mode_for_redundancy"
    widget: number_field
    value: 0
    step: 1
    help: "mmseqs parameter for coverage mode: 0 for both, 1 for target and 2 for query sequence"

  save_non_redundant_seqs_fasta:
    label: "save_non_redundant_seqs_fasta"
    widget: select
    options:
      - ['false', 'false']
      - ['true', 'true']
    help: "Save the final family fasta files with sequence redundancy removed"


form:
  - bc_num_hours
  - executor
  - partition
  - num_cores
  - num_memory
  - workdir
  - input_output_options
  - input
  - outdir
  - multiqc_title
  - clustering_params
  - save_mmseqs_db
  - clustering_tool
  - cluster_seq_identity
  - cluster_coverage
  - cluster_cov_mode
  - save_mmseqs_clustering
  - cluster_size_threshold
  - save_mmseqs_chunked_fasta
  - alignment_params
  - alignment_tool
  - clipkit_out_format
  - trim_ends_only
  - gap_threshold
  - hmmsearch_evalue_cutoff
  - save_hmmsearch_results
  - hmmsearch_query_length_threshold
  - save_hmmsearch_filtered_fasta
  - redundancy_params
  - hmmsearch_family_length_threshold
  - save_non_redundant_fams_fasta
  - cluster_seq_identity_for_redundancy
  - cluster_coverage_for_redundancy
  - cluster_cov_mode_for_redundancy
  - save_non_redundant_seqs_fasta
  - tower_access_token
  - resume
